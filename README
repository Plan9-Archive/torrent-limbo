# status

in development.  don't expect things to work yet.


# intro

this package contains a bittorrent peer (for downloading and uploading
files), tools for verifying torrents & printing information about
torrents, a bittorrent tracker for use with a http server, and a
program for creating torrent files.


# install

this package depends on "http", "web" and "util".

to install, bind/symlink/include a mkconfig (e.g. from your inferno
install), and:

	mk install

when building from within inferno, insert SYSHOST=Inferno and ROOT=
in the mk invocations to override the values in the mkconfig.


# latest

the latest version can be found at

    http://www.ueber.net/code/r/torrent


# licence & author

all files are in the public domain.  this code has been written by
mechiel lukkien, reachable at mechiel@ueber.net or mechiel@xs4all.nl.


# todo

- remove the premature optimisations
- explain the design better


## wm/torrent: 

- available bar is not smoothly filled
- figure out how to fill the panel with the bars (and thus bars themselves) in x direction
- catch resizes and recreate the bars with new width.
- merge the state & info grids, so they have same widths?
- update grids without redrawing completely?
- make torrent/peer send events on removal of bad peers?  and remove them from our list.  or at least reserve the peerevent message for it.
- clear stale entries from badpeers list.
- limit the history in torrentlog & peerlog.
- could add buttons to peers grid, to disconnect peers.
- availbar seems to pieces with overlap, on the edges of the piece

## torrent/peer

- totalleft still becomes negative.  we are probably refetching blocks.  perhaps we don't verify correctly, or mess up writing?
- peer down/up speed in Qpeers is always 0...  something is wrong with traffic accounting.
- make eta fluctuate far less.  the bandwidth can be up to date, the eta should lag a bit, to give slower changes
- don't keep doing tracker requests every 10 seconds.  even during startup it is too much.  we should start at 30, then back off to tracker's interval.
- we don't seem to dial other peers after the first?
- after having had a peer/seed, but no longer, do a tracker request before interval.  not too often though.
- only set "have" for piece when we've written it to disk?  otherwise we might read it from disk (and send it to a peer) before having written it.
- lots of testing
- for unused peers from tracker, make difference between new ip's and known ip's (current peers, bad peers).
- put more in progress/peerevents, such as errors (eg errors when writing to disk).
- perhaps put the code for each thread in a separate file.  should help to reduce accidental global variable use & associated obscure bugs.
- allow starting after being stopped.  implement start ctl.
- write manual page
- optim: Piece.hashstate, for keeping the hash of the piece up to date in case of sequentially fetching blocks (a common case).
- make the scheduler capable of taking abuse into account.  the more abuse from peers (bogus hashes), the fewer peers we schedule on a single peer?  or the harder we try to correct faulty blocks?  make sure it's all the same standard code path, to prevent obscure bugs only laid bare by abusive peers.

## torrent/track

- make search for a peer (given ip & port) less inefficient.
- might add scraping.
- might be a bit smarter about which peers to send to a peer.  e.g. not itself, make randomizing cheaper, let peers that are done (left=0) not connect to each other.
